ü
GC:\Users\andre\Documents\prueba60\Api\Controllers\DescargaController.cs
	namespace

 	
Api


 
.

 
Controllers

 
{ 
[ 
ApiController 
] 
public 

class 
DescargaController #
:$ %

Controller& 0
{ 
[ 	
Route	 
( 
$str 
) 
] 
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
	Descargas* 3
(3 4
List4 8
<8 9
	IFormFile9 B
>B C
filesD I
)I J
{ 	
foreach 
( 
var 
formfile  
in! #
files$ )
)) *
{ 
var 
filepath 
= 
Path #
.# $
GetRandomFileName$ 5
(5 6
)6 7
;7 8
using 
( 
var 
stream !
=! "
System" (
.( )
IO) +
.+ ,
File, 0
.0 1
Create1 7
(7 8
filepath8 @
)@ A
)A B
{ 
await 
formfile "
." #
CopyToAsync# .
(. /
stream/ 5
)5 6
;6 7
} 
} 
return 
Ok 
( 
) 
; 
}   	
[!! 	
Route!!	 
(!! 
$str!! 
)!! 
]!! 
["" 	
HttpPost""	 
]"" 
public## 
async## 
Task## 
<## 
IActionResult## '
>##' (
Descarga##) 1
(##1 2
[##2 3
FromForm##3 ;
]##; <
	FileModel##= F
file##G K
)##K L
{$$ 	
string%% 
path%% 
=%% 
Path%% 
.%% 
Combine%% &
(%%& '
	Directory%%' 0
.%%0 1
GetCurrentDirectory%%1 D
(%%D E
)%%E F
,%%F G
$str%%H Q
,%%Q R
file%%S W
.%%W X
FileName%%X `
)%%` a
;%%a b
using&& 
(&& 
Stream&& 
stream&& 
=&&  
new&&  #

FileStream&&$ .
(&&. /
path&&/ 3
,&&3 4
FileMode&&4 <
.&&< =
Create&&= C
)&&C D
)&&D E
{'' 
await(( 
file(( 
.(( 
FormFile(( #
.((# $
CopyToAsync(($ /
(((/ 0
stream((0 6
)((6 7
;((7 8
})) 
return++ 
Ok++ 
(++ 
)++ 
;++ 
},, 	
[-- 	
Route--	 
(-- 
$str-- 
)-- 
]-- 
[.. 	
HttpGet..	 
].. 
public// 
IActionResult// 
Get//  
(//  !
[//! "
FromForm//" *
]//* +
	FileModel//, 5
file//6 :
)//: ;
{00 	
return44 
Ok44 
(44 
)44 
;44 
}55 	
}66 
}77 Œ
NC:\Users\andre\Documents\prueba60\Api\Controllers\WeatherForecastController.cs
	namespace 	
Api
 
. 
Controllers 
{ 
[ 
ApiController 
] 
public 

class %
WeatherForecastController *
:+ ,

Controller- 7
{ 
public %
WeatherForecastController (
(( )
ILogger) 0
<0 1%
WeatherForecastController1 J
>J K
loggerL R
)R S
{ 	
} 	
[ 	
HttpGet	 
] 
public 
IEnumerable 
< 
WeatherForecast *
>* +
Get, /
(/ 0
)0 1
{ 	
var 

connection 
= 
new   
HubConnectionBuilder! 5
(5 6
)6 7
.7 8
WithUrl8 ?
(? @
$str@ c
,c d
(e f
optsf j
)j k
=>l n
{ 
opts   
.   %
HttpMessageHandlerFactory   .
=  / 0
(  1 2
message  2 9
)  9 :
=>  ; =
{!! 
if"" 
("" 
message"" 
is""  "
HttpClientHandler""# 4
clientHandler""5 B
)""B C
clientHandler$$ %
.$$% &5
)ServerCertificateCustomValidationCallback$$& O
+=$$P R
(%% 
sender%% #
,%%# $
certificate%%% 0
,%%0 1
chain%%2 7
,%%7 8
sslPolicyErrors%%9 H
)%%H I
=>%%J L
{%%M N
return%%O U
true%%V Z
;%%Z [
}%%\ ]
;%%] ^
return&& 
message&& "
;&&" #
}'' 
;'' 
}(( 
)(( 
.(( 
Build(( 
((( 
)(( 
;(( 

connection++ 
.++ 

StartAsync++ !
(++! "
)++" #
.++# $
ContinueWith++$ 0
(++0 1
t++1 2
=>++3 5
{,, 
if-- 
(-- 
t-- 
.-- 
	IsFaulted-- 
)--  
{.. 
Console// 
.// 
	WriteLine// %
(//% &
$str//& D
+//E F
t//G H
.//H I
	Exception//I R
.//R S
GetBaseException//S c
(//c d
)//d e
)//e f
;//f g
}00 
else11 
{22 
Console33 
.33 
	WriteLine33 %
(33% &
$str33& 1
)331 2
;332 3
}44 
}55 
)55 
.55 
Wait55 
(55 
)55 
;55 
var<< 
rng<< 
=<< 
new<< 
Random<<  
(<<  !
)<<! "
;<<" #
return== 

Enumerable== 
.== 
Range== #
(==# $
$num==$ %
,==% &
$num==' (
)==( )
.==) *
Select==* 0
(==0 1
index==1 6
=>==7 9
new==: =
WeatherForecast==> M
{>> 
Date?? 
=?? 
DateTime?? 
.??  
Now??  #
.??# $
AddDays??$ +
(??+ ,
index??, 1
)??1 2
,??2 3
TemperatureC@@ 
=@@ 
rng@@ "
.@@" #
Next@@# '
(@@' (
-@@( )
$num@@) +
,@@+ ,
$num@@- /
)@@/ 0
,@@0 1
}BB 
)BB 
.CC 
ToArrayCC 
(CC 
)CC 
;CC 
}DD 	
}EE 
}FF µ
9C:\Users\andre\Documents\prueba60\Api\Models\FileModel.cs
	namespace 	
Api
 
. 
Models 
{ 
public 

class 
	FileModel 
{ 
public 
string 
FileName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
	IFormFile 
FormFile !
{" #
get$ '
;' (
set) ,
;, -
}. /
}		 
}

 ê
BC:\Users\andre\Documents\prueba60\Api\Models\MarcasUpdateFilter.cs
	namespace 	
	ApiDomain
 
. 
	DtoModels 
. 
AssetFilters *
{ 
public		 

class		 
MarcasUpdateFilter		 #
{

 
public 
MarcasUpdateFilter !
(! "
)" #
{ 	
AssetIds 
= 
new 
List 
<  
int  #
># $
($ %
)% &
;& '
} 	
public 
string 
CodMarca 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	
Required	 
] 
public 
string 
	AssetType 
{  !
get" %
;% &
set' *
;* +
}, -
public 
bool 
IsIncrementalLoad %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
List 
< 
int 
> 
AssetIds !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	

JsonIgnore	 
] 
public 
int 
PerimeterId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
EndDate 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} œ
0C:\Users\andre\Documents\prueba60\Api\Program.cs
	namespace 	
Api
 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. 
ConfigureServices #
(# $
($ %
hostContext% 0
,0 1
services2 :
): ;
=>< >
{ 
services 
. 
AddHostedService .
<. /!
FileWatcherBackground/ D
>D E
(E F
)F G
;G H
} 
) 
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
}   ©<
GC:\Users\andre\Documents\prueba60\Api\Servicer\FileWatcherBackground.cs
	namespace 	
Api
 
. 
Servicer 
{ 
public 

class !
FileWatcherBackground &
:' (
BackgroundService) :
{ 
private 
readonly 
IHostEnvironment )
_env* .
;. /
public !
FileWatcherBackground $
($ %
IHostEnvironment% 5
env6 9
)9 :
{ 	
_env 
= 
env 
; 
} 	
	protected 
override 
Task 
ExecuteAsync  ,
(, -
CancellationToken- >
stoppingToken? L
)L M
{ 	
string 
path 
= 
Path 
. 
Combine &
(& '
_env' +
.+ ,
ContentRootPath, ;
,; <
$str= F
)F G
;G H
FileSystemWatcher 
_fsw "
=# $
new% (
FileSystemWatcher) :
(: ;
path; ?
,? @
$strA I
)I J
;J K
_fsw 
. 
Created 
+= 
fsw_Created '
;' (
_fsw 
. 
Changed 
+= 
fsw_Changed '
;' (
_fsw 
. 
Renamed 
+= 
fsw_Renamed '
;' (
_fsw 
. 
Deleted 
+= 
fsw_Deleted '
;' (
_fsw 
. 
Error 
+= 
	fsw_Error #
;# $
_fsw   
.   
EnableRaisingEvents   $
=  % &
true  ' +
;  + ,
return## 
Task## 
.## 
CompletedTask## %
;##% &
}$$ 	
private&& 
void&& 
fsw_Changed&&  
(&&  !
object&&! '
sender&&( .
,&&. /
FileSystemEventArgs&&0 C
fileSystemEventArgs&&D W
)&&W X
{'' 	
Console(( 
.(( 
	WriteLine(( 
((( 
$str(( ;
)((; <
;((< =
})) 	
private++ 
void++ 
fsw_Deleted++  
(++  !
object++! '
sender++( .
,++. /
FileSystemEventArgs++/ B
e++C D
)++D E
{,, 	
Console-- 
.-- 
	WriteLine-- 
(-- 
$str-- .
)--. /
;--/ 0
}.. 	
private// 
void// 
fsw_Created//  
(//  !
object//! '
sender//( .
,//. /
FileSystemEventArgs/// B
e//C D
)//D E
{00 	
Console11 
.11 
	WriteLine11 
(11 
$str	11 …
)
11… †
;
11† ‡
Task22 
.22 
Delay22 
(22 
$num22 
)22 
.22 
Wait22 !
(22! "
)22" #
;22# $
LeerArchivo33 
(33 
e33 
.33 
FullPath33 "
)33" #
;33# $
}44 	
private66 
void66 
	fsw_Error66 
(66 
object66 %
sender66& ,
,66, -
ErrorEventArgs66- ;
e66< =
)66= >
{77 	
Console88 
.88 
	WriteLine88 
(88 
$str88 B
)88B C
;88C D
}99 	
private:: 
void:: 
fsw_Renamed::  
(::  !
object::! '
sender::( .
,::. /
FileSystemEventArgs::/ B
e::C D
)::D E
{;; 	
Console<< 
.<< 
	WriteLine<< 
(<< 
$str<< 2
)<<2 3
;<<3 4
}== 	
private>> 
void>> 
LeerArchivo>>  
(>>  !
string>>! '
path>>( ,
)>>, -
{?? 	
ISheet@@ 
sheet@@ 
;@@ 
ListAA 
<AA 
stringAA 
>AA 
rowListAA  
=AA! "
newAA# &
ListAA' +
<AA+ ,
stringAA, 2
>AA2 3
(AA3 4
)AA4 5
;AA5 6
usingCC 
(CC 
varCC 
streamCC 
=CC 
newCC  #

FileStreamCC$ .
(CC. /
pathCC/ 3
,CC3 4
FileModeCC4 <
.CC< =
OpenCC= A
)CCA B
)CCB C
{DD 
streamEE 
.EE 
PositionEE 
=EE  !
$numEE" #
;EE# $
XSSFWorkbookFF 
xssWorkbookFF (
=FF) *
newFF+ .
XSSFWorkbookFF/ ;
(FF; <
streamFF< B
)FFB C
;FFC D
sheetGG 
=GG 
xssWorkbookGG #
.GG# $

GetSheetAtGG$ .
(GG. /
$numGG/ 0
)GG0 1
;GG1 2
IRowHH 
	headerRowHH 
=HH  
sheetHH! &
.HH& '
GetRowHH' -
(HH- .
$numHH. /
)HH/ 0
;HH0 1
intII 
	cellCountII 
=II 
	headerRowII  )
.II) *
LastCellNumII* 5
;II5 6
forKK 
(KK 
intKK 
iKK 
=KK 
(KK 
sheetKK #
.KK# $
FirstRowNumKK$ /
+KK0 1
$numKK1 2
)KK2 3
;KK3 4
iKK5 6
<=KK7 9
sheetKK: ?
.KK? @

LastRowNumKK@ J
;KKJ K
iKKL M
++KKM O
)KKO P
{LL 
IRowMM 
rowMM 
=MM 
sheetMM $
.MM$ %
GetRowMM% +
(MM+ ,
iMM, -
)MM- .
;MM. /
ifNN 
(NN 
rowNN 
==NN 
nullNN #
)NN# $
continueNN% -
;NN- .
ifOO 
(OO 
rowOO 
.OO 
CellsOO !
.OO! "
AllOO" %
(OO% &
dOO& '
=>OO( *
dOO+ ,
.OO, -
CellTypeOO- 5
==OO6 8
CellTypeOO9 A
.OOA B
BlankOOB G
)OOG H
)OOH I
continueOOJ R
;OOR S
forQQ 
(QQ 
intQQ 
jQQ 
=QQ  
rowQQ! $
.QQ$ %
FirstCellNumQQ% 1
;QQ1 2
jQQ2 3
<QQ3 4
	cellCountQQ4 =
;QQ= >
jQQ? @
++QQ@ B
)QQB C
{RR 
ifSS 
(SS 
rowSS 
.SS  
GetCellSS  '
(SS' (
jSS( )
)SS) *
!=SS+ -
nullSS. 2
&&SS3 5
!SS6 7
stringSS7 =
.SS= >
IsNullOrEmptySS> K
(SSK L
rowSSL O
.SSO P
GetCellSSP W
(SSW X
jSSX Y
)SSY Z
.SSZ [
ToStringSS[ c
(SSc d
)SSd e
)SSe f
)SSf g
{TT 
rowListVV  '
.VV' (
AddVV( +
(VV+ ,
rowVV, /
.VV/ 0
GetCellVV0 7
(VV7 8
jVV8 9
)VV9 :
.VV: ;
ToStringVV; C
(VVC D
)VVD E
)VVE F
;VVF G
}YY 
}ZZ 
}[[ 
}`` 
}cc 	
}dd 
}ee ï
0C:\Users\andre\Documents\prueba60\Api\Startup.cs
	namespace 	
Api
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddControllers #
(# $
)$ %
;% &
services 
. 
AddCors 
( 
options $
=>% '
options( /
./ 0
	AddPolicy0 9
(9 :
$str: G
,G H
builderI P
=>Q S
builderT [
.[ \
WithOrigins\ g
(g h
$strh {
){ |
.  Y Z
AllowAnyMethod  Z h
(  h i
)  i j
.!!Y Z
AllowAnyHeader!!Z h
(!!h i
)!!i j
.""Y Z
AllowCredentials""Z j
(""j k
)""k l
)""l m
)""m n
;""n o
services$$ 
.$$ 

AddSignalR$$ 
($$  
o$$  !
=>$$" $
{$$% &
o%% 
.%%  
EnableDetailedErrors%% &
=%%' (
true%%) -
;%%- .
}&& 
)&& 
;&& 
}'' 	
public** 
void** 
	Configure** 
(** 
IApplicationBuilder** 1
app**2 5
,**5 6
IWebHostEnvironment**7 J
env**K N
)**N O
{++ 	
if,, 
(,, 
env,, 
.,, 
IsDevelopment,, !
(,,! "
),," #
),,# $
{-- 
app.. 
... %
UseDeveloperExceptionPage.. -
(..- .
)... /
;../ 0
}// 
app33 
.33 

UseRouting33 
(33 
)33 
;33 
app77 
.77 
UseCors77 
(77 
$str77 %
)77% &
;77& '
app:: 
.:: 
UseEndpoints:: 
(:: 
	endpoints:: &
=>::' )
{;; 
	endpoints<< 
.<< 
MapControllers<< (
(<<( )
)<<) *
;<<* +
}?? 
)?? 
;?? 
}@@ 	
}AA 
}BB µ
8C:\Users\andre\Documents\prueba60\Api\WeatherForecast.cs
	namespace 	
Api
 
{ 
public 

class 
WeatherForecast  
{ 
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public		 
int		 
TemperatureC		 
{		  !
get		" %
;		% &
set		' *
;		* +
}		, -
public 
int 
TemperatureF 
=>  "
$num# %
+& '
(( )
int) ,
), -
(- .
TemperatureC. :
/; <
$num= C
)C D
;D E
public 
string 
Summary 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} 